FROM eclipse-temurin:17-jre-jammy
LABEL authors="asingk"

RUN apt-get update && apt-get install -y --no-install-recommends \
    tzdata openssh-client ca-certificates fontconfig && \
    rm -rf /var/lib/apt/lists/*
ENV TZ=Asia/Jakarta

# Create group and user with home directory
RUN groupadd -r asingk && useradd -r -g asingk -d /home/asingk -m -s /bin/bash asingk

# Prepare fonts
COPY fonts/*.ttf /tmp/fonts/
RUN mkdir -p /usr/share/fonts/truetype/ && \
    install -m644 /tmp/fonts/*.ttf /usr/share/fonts/truetype/ && \
    fc-cache -f && \
    rm -rf /tmp/fonts

# Prepare SSH known_hosts as root, then fix ownership
RUN mkdir -p /home/asingk/.ssh && \
    touch /home/asingk/.ssh/known_hosts && \
    ssh-keyscan -H 192.168.176.26 >> /home/asingk/.ssh/known_hosts && \
    chown -R asingk:asingk /home/asingk

USER asingk
WORKDIR /home/asingk

#ARG JAR_FILE=build/libs/*SNAPSHOT.jar
ARG JAR_FILE=build/libs/*RELEASE.jar
COPY --chown=asingk:asingk ${JAR_FILE} app.jar

ENTRYPOINT ["java","-jar","app.jar"]